<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¬´ë£Œ ë ˆìŠ¨ í…ŒìŠ¤íŠ¸</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
    .result { margin: 20px 0; padding: 15px; border: 2px solid #ddd; border-radius: 5px; }
    .success { border-color: #4caf50; background: #e8f5e9; }
    .error { border-color: #f44336; background: #ffebee; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px 5px; }
  </style>
</head>
<body>
  <h1>ğŸ” ë¬´ë£Œ ë ˆìŠ¨ ë°ì´í„° í™•ì¸</h1>
  <p>ì´ í˜ì´ì§€ëŠ” Firestoreì—ì„œ ì‹¤ì œ ë ˆìŠ¨ ë°ì´í„°ë¥¼ ì½ì–´ì™€ <code>isFree</code> ê°’ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
  
  <div>
    <button onclick="checkLesson()">ë ˆìŠ¨ ë°ì´í„° í™•ì¸</button>
    <button onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
  </div>
  
  <div id="result"></div>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyCbVPbM6mi0oNy_aPGhcZr-wSa5ByPpVFM",
      authDomain: "aiacademy-36b79.firebaseapp.com",
      projectId: "aiacademy-36b79",
      storageBucket: "aiacademy-36b79.firebasestorage.app",
      messagingSenderId: "1061803881843",
      appId: "1:1061803881843:web:7d1c7ffba2c68ad9835ef7"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    let currentUser = null;
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      document.getElementById('result').innerHTML = user 
        ? `<div class="result">âœ… ë¡œê·¸ì¸ë¨: ${user.email || user.uid}</div>`
        : `<div class="result">âš ï¸ ë¡œê·¸ì¸ ì•ˆ ë¨</div>`;
    });
    
    window.checkLesson = async function() {
      const resultEl = document.getElementById('result');
      resultEl.innerHTML = '<div class="result">â³ ë°ì´í„° ì½ëŠ” ì¤‘...</div>';
      
      try {
        const courseId = 'MaxPhfaxduGUIdPzFte4';
        const lessonId = 'fCyDtbvnMvQoLzhqncvp';
        
        const lessonRef = doc(db, 'courses', courseId, 'lessons', lessonId);
        const lessonSnap = await getDoc(lessonRef);
        
        if (!lessonSnap.exists()) {
          resultEl.innerHTML = '<div class="result error">âŒ ë ˆìŠ¨ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        
        const data = lessonSnap.data();
        const isFree = data.isFree;
        const isFreeType = typeof isFree;
        const isFreeValue = isFree === true;
        
        const html = `
          <div class="result ${isFreeValue ? 'success' : 'error'}">
            <h3>${isFreeValue ? 'âœ… ë¬´ë£Œ ë ˆìŠ¨ ì„¤ì •ë¨' : 'âŒ ë¬´ë£Œ ë ˆìŠ¨ ì•„ë‹˜'}</h3>
            <p><strong>ë ˆìŠ¨ ì œëª©:</strong> ${data.title || '(ì—†ìŒ)'}</p>
            <p><strong>isFree ê°’:</strong> <code>${JSON.stringify(isFree)}</code></p>
            <p><strong>isFree íƒ€ì…:</strong> <code>${isFreeType}</code></p>
            <p><strong>isFree === true:</strong> <code>${isFreeValue}</code></p>
            <p><strong>ì˜ìƒ URL:</strong> ${data.video?.src ? 'ìˆìŒ' : 'ì—†ìŒ'}</p>
            <hr>
            <details>
              <summary>ì „ì²´ ë°ì´í„° ë³´ê¸°</summary>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </details>
          </div>
        `;
        resultEl.innerHTML = html;
        
      } catch (e) {
        resultEl.innerHTML = `<div class="result error">âŒ ì—ëŸ¬: ${e.message}</div>`;
        console.error(e);
      }
    };
  </script>
</body>
</html>
